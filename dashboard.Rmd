---
title: "British Columbia Rainfall map"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)

library(tidyr)
library(dplyr)
library(magrittr)

library(ggplot2)

library(leaflet)
library(leaflet.extras)
```

```{r data loading, include=FALSE}
coords <- read.csv("dat/gev_24h.csv", header = TRUE)

grid <- read.csv("dat/grid.csv", header = TRUE)
```

```{r icons, include=FALSE}
water <- makeAwesomeIcon(
  icon = "water-outline",
  library = "ion"
)
```

```{r label, include=FALSE}
coords %<>% mutate(Label = paste("<b>", Name, 
                                 "</b><br>ID : ", ID, 
                                 "<br>Latitude : ", Lat, 
                                 "<br>Longitude : ", Lon, 
                                 "<br>Elevation : ", Elevation, " m",
                                 "<br>μ : ", μ,
                                 "<br>ϕ : ", ϕ,
                                 "<br>ξ :", ξ))
```


# Stations' map

```{r map}
elevation.pal <- colorNumeric(
  palette = "YlOrRd",
  domain = coords$Elevation)

leaflet(data = coords) %>%
  addTiles() %>%
  addCircleMarkers(lng = ~Lon,
              lat = ~Lat,
             popup = ~Label,
             label = ~ID,
             stroke = FALSE,
             fillOpacity = 0.8,
             radius = 8,
             color = ~elevation.pal(Elevation)) %>%
  addLegend(position = "topright",
            pal = elevation.pal,
            values = ~Elevation,
            title = "Altitude in m",
            labFormat = labelFormat(suffix = " m"),
            opacity = 1) %>%
  addResetMapButton()
```

# Location parameter

```{r}

location.pal <- colorNumeric(
  palette = "YlOrRd",
  domain = coords$μ)

leaflet(data = coords) %>%
  addTiles() %>%
  addCircleMarkers(lng = ~Lon,
              lat = ~Lat,
             popup = ~Label,
             label = ~ID,
             stroke = FALSE,
             fillOpacity = 0.8,
             radius = 8,
             color = ~location.pal(μ)) %>%
  addLegend(position = "topright",
            pal = location.pal,
            values = ~μ,
            title = "Location parameter μ",
            opacity = 1) %>%
  addResetMapButton()
```

# Scale parameter

```{r}

scale.pal <- colorNumeric(
  palette = "YlOrRd",
  domain = coords$ϕ)

leaflet(data = coords) %>%
  addTiles() %>%
  addCircleMarkers(lng = ~Lon,
              lat = ~Lat,
             popup = ~Label,
             label = ~ID,
             stroke = FALSE,
             fillOpacity = 0.8,
             radius = 8,
             color = ~scale.pal(ϕ)) %>%
  addLegend(position = "topright",
            pal = scale.pal,
            values = ~ϕ,
            title = "Scale parameter ϕ",
            opacity = 1) %>%
  addResetMapButton()
```

# Shape parameter

```{r}
shape.pal <- colorNumeric(
  palette = "YlOrRd",
  domain = coords$ξ)

leaflet(data = coords) %>%
  addTiles() %>%
  addCircleMarkers(lng = ~Lon,
              lat = ~Lat,
             popup = ~Label,
             label = ~ID,
             stroke = FALSE,
             fillOpacity = 0.8,
             radius = 8,
             color = ~shape.pal(ξ)) %>%
  addLegend(position = "topright",
            pal = shape.pal,
            values = ~ξ,
            title = "Shape parameter ξ",
            opacity = 1) %>%
  addResetMapButton()
```

# Grid cells


```{r grid}

#leaflet(data = grid) %>%
  # addTiles() %>%
  # addCircleMarkers(lng = ~lon,
  #             lat = ~lat,
  #            stroke = FALSE,
  #            fillOpacity = 0.8,
  #            radius = 4) %>%
  # addResetMapButton()

```

